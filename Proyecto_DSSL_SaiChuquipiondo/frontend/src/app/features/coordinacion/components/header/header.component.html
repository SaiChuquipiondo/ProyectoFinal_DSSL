<header class="dashboard-header">
  <div class="header-container">
    <!-- Brand -->
    <div class="brand-section">
      <div class="brand-logo-wrapper">
        <img src="/logo-unu.png" alt="UNU Logo" class="brand-logo" />
      </div>
      <div class="brand-info">
        <h1>Sistema de Gestión de Tesis</h1>
        <p class="brand-subtitle">Panel de Coordinación Académica</p>
      </div>
    </div>

    <!-- Actions -->
    <div class="header-actions">
      <!-- Botón Crear Usuario (Solo visible si no estamos ya en esa página, opcional) -->
      <button
        class="action-btn"
        routerLink="/coordinacion/crear-usuario"
        routerLinkActive="hidden"
        [routerLinkActiveOptions]="{ exact: true }"
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
          <circle cx="8.5" cy="7" r="4" />
          <line x1="20" y1="8" x2="20" y2="14" />
          <line x1="23" y1="11" x2="17" y2="11" />
        </svg>
        Crear Usuario
      </button>

      <!-- Notifications -->
      <button class="notification-btn" (click)="toggleNotifications()">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
          <path d="M13.73 21a2 2 0 0 1-3.46 0" />
        </svg>
        <span *ngIf="noLeidasCount > 0" class="notification-badge">{{ noLeidasCount }}</span>
      </button>

      <!-- Profile -->
      <div class="user-profile">
        <div class="user-avatar-circle">
          <span>{{ getUserInitials() }}</span>
        </div>
        <div class="user-details">
          <p class="user-name">{{ getUserFullName() }}</p>
          <p class="user-role-text">{{ getUserRole() }}</p>
        </div>
      </div>

      <!-- Logout -->
      <button class="logout-button" (click)="logout()">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
          <polyline points="16 17 21 12 16 7" />
          <line x1="21" y1="12" x2="9" y2="12" />
        </svg>
        Salir
      </button>
    </div>
  </div>
</header>

<!-- Notifications Panel -->
<div class="notifications-panel" [class.open]="showNotifications">
  <div class="panel-header">
    <h3>Notificaciones</h3>
    <button class="close-panel" (click)="toggleNotifications()">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
  </div>

  <div *ngIf="notificaciones.length > 0" class="panel-actions">
    <button class="mark-all-read" (click)="marcarTodasLeidas()">
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <polyline points="20 6 9 17 4 12" />
      </svg>
      Marcar todas como leídas
    </button>
  </div>

  <div class="notifications-list">
    <div *ngIf="cargandoNotificaciones" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando...</p>
    </div>

    <div *ngIf="!cargandoNotificaciones && notificaciones.length === 0" class="empty-notifications">
      <p>No tienes notificaciones</p>
    </div>

    <div
      *ngFor="let notif of notificaciones"
      class="notification-item"
      [class.unread]="!notif.leida"
      (click)="toggleExpand(notif.id_notificacion)"
    >
      <div class="notif-icon">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
        </svg>
      </div>
      <div class="notif-content">
        <h4>{{ notif.titulo }}</h4>
        <p [class.expanded-text]="isExpanded(notif.id_notificacion)">{{ notif.mensaje }}</p>
        <span class="notif-time">{{ getTimeAgo(notif.fecha_creacion) }}</span>
      </div>
      <div *ngIf="!notif.leida" class="unread-dot"></div>
    </div>
  </div>
</div>

<div *ngIf="showNotifications" class="overlay" (click)="toggleNotifications()"></div>
