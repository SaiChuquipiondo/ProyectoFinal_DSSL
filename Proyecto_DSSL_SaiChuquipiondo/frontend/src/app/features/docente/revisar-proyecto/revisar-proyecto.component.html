<div class="review-container">
  <!-- Header -->
  <div class="review-header">
    <button class="btn-back" routerLink="/docente/dashboard">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M19 12H5" />
        <polyline points="12 19 5 12 12 5" />
      </svg>
      Volver al Dashboard
    </button>
    <h1 class="page-title">Revisión de Proyecto</h1>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-state">
    <div class="loader"></div>
    <p>Cargando información del proyecto...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading && !successMessage" class="alert-error">
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <circle cx="12" cy="12" r="10" />
      <line x1="15" y1="9" x2="9" y2="15" />
      <line x1="9" y1="9" x2="15" y2="15" />
    </svg>
    <p>{{ error }}</p>
  </div>

  <!-- Success -->
  <div *ngIf="successMessage" class="alert-success">
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <polyline points="20 6 9 17 4 12" />
    </svg>
    <p>{{ successMessage }}</p>
    <small>Redirigiendo al dashboard...</small>
  </div>

  <!-- Project Review Content -->
  <div *ngIf="proyecto && !loading && !successMessage" class="review-content">
    <!-- Project Info Section -->
    <div class="project-info-card">
      <div class="card-header-modern">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
          <polyline points="14 2 14 8 20 8" />
        </svg>
        <h2>{{ proyecto.titulo }}</h2>
      </div>

      <div class="card-body-modern">
        <div class="info-grid">
          <div class="info-item">
            <label>Estudiante</label>
            <div class="info-value">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
              <span>{{ proyecto.nombre_estudiante }}</span>
            </div>
          </div>

          <div class="info-item">
            <label>Código universitario</label>
            <div class="info-value">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
              </svg>
              <span>{{ proyecto.codigo_estudiante }}</span>
            </div>
          </div>

          <div class="info-item">
            <label>Iteración</label>
            <div class="info-value">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="23 4 23 10 17 10" />
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
              </svg>
              <span>Iteración {{ proyecto.iteracion }}</span>
            </div>
          </div>

          <div class="info-item">
            <label>Estado</label>
            <div class="info-value">
              <span
                class="status-badge"
                [class.status-primera]="proyecto.estado_proyecto === 'REVISADO_FORMATO'"
                [class.status-resubmision]="proyecto.estado_proyecto === 'OBSERVADO_ASESOR'"
              >
                {{
                  proyecto.estado_proyecto === 'REVISADO_FORMATO'
                    ? 'Primera revisión'
                    : 'Resubmisión'
                }}
              </span>
            </div>
          </div>
        </div>

        <div class="resumen-section">
          <label>Resumen del Proyecto</label>
          <p>{{ proyecto.resumen }}</p>
        </div>

        <button class="btn-view-pdf" (click)="verPDF()">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
          </svg>
          Ver PDF del Proyecto
        </button>
      </div>
    </div>

    <!-- Review Form Section -->
    <div class="review-form-card">
      <div class="card-header-modern">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="9 11 12 14 22 4" />
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
        </svg>
        <h2>Decisión de Revisión</h2>
      </div>

      <div class="card-body-modern">
        <form (ngSubmit)="enviarRevision()">
          <!-- Decisión -->
          <div class="form-group">
            <label>Decisión *</label>
            <div class="radio-group">
              <label class="radio-option" [class.selected]="estadoRevision === 'APROBADO'">
                <input
                  type="radio"
                  id="aprobar"
                  name="estadoRevision"
                  value="APROBADO"
                  [(ngModel)]="estadoRevision"
                  [disabled]="submitting"
                />
                <div class="radio-content">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                  <span>Aprobar Proyecto</span>
                </div>
              </label>

              <label class="radio-option" [class.selected]="estadoRevision === 'OBSERVADO'">
                <input
                  type="radio"
                  id="observar"
                  name="estadoRevision"
                  value="OBSERVADO"
                  [(ngModel)]="estadoRevision"
                  [disabled]="submitting"
                />
                <div class="radio-content">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <line x1="12" y1="8" x2="12" y2="12" />
                    <line x1="12" y1="16" x2="12.01" y2="16" />
                  </svg>
                  <span>Observar Proyecto</span>
                </div>
              </label>
            </div>
          </div>

          <!-- Comentarios -->
          <div class="form-group">
            <label for="comentarios">
              Comentarios {{ estadoRevision === 'OBSERVADO' ? '*' : '(opcional)' }}
            </label>
            <textarea
              id="comentarios"
              rows="8"
              [(ngModel)]="comentarios"
              [disabled]="submitting"
              name="comentarios"
              [placeholder]="
                estadoRevision === 'OBSERVADO'
                  ? 'Indique las observaciones que debe corregir el estudiante...'
                  : 'Comentarios adicionales...'
              "
            ></textarea>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            class="btn-submit"
            [class.btn-success]="estadoRevision === 'APROBADO'"
            [class.btn-warning]="estadoRevision === 'OBSERVADO'"
            [disabled]="submitting || !estadoRevision"
          >
            <span *ngIf="!submitting">
              <svg
                *ngIf="estadoRevision === 'APROBADO'"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
              <svg
                *ngIf="estadoRevision === 'OBSERVADO'"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="8" x2="12" y2="12" />
                <line x1="12" y1="16" x2="12.01" y2="16" />
              </svg>
              {{
                estadoRevision === 'APROBADO'
                  ? 'Aprobar Proyecto'
                  : estadoRevision === 'OBSERVADO'
                  ? 'Observar Proyecto'
                  : 'Seleccione una opción'
              }}
            </span>
            <span *ngIf="submitting">
              <span class="spinner"></span>
              Enviando...
            </span>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
