<div class="modern-dashboard">
  <!-- Top Navigation Bar -->
  <nav class="top-navbar">
    <div class="nav-content">
      <div class="nav-brand">
        <img src="/logo-unu.png" alt="UNU" class="nav-logo" />
        <div class="nav-title">
          <h1>Sistema de Gestión de Tesis</h1>
          <span>Panel Docente</span>
        </div>
      </div>

      <div class="nav-user">
        <div class="user-info">
          <span class="user-greeting">Ing. {{ getUserFullName() }}</span>
          <span class="user-role">Docente</span>
        </div>

        <button class="notification-btn" (click)="toggleNotifications()">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
          </svg>
          @if (noLeidasCount > 0) {
          <span class="notification-badge">{{ noLeidasCount }}</span>
          }
        </button>

        <button class="btn-logout" (click)="logout()">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Notifications Panel -->
  <div class="notifications-panel" [class.open]="showNotifications">
    <div class="panel-header">
      <h3>Notificaciones</h3>
      <button class="close-panel" (click)="toggleNotifications()">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    @if (notificaciones.length > 0) {
    <div class="panel-actions">
      <button class="mark-all-read" (click)="marcarTodasLeidas()">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="20 6 9 17 4 12" />
        </svg>
        Marcar todas como leídas
      </button>
    </div>
    }

    <div class="notifications-list">
      @if (cargandoNotificaciones) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Cargando notificaciones...</p>
      </div>
      } @else if (notificaciones.length === 0) {
      <div class="empty-notifications">
        <svg
          width="64"
          height="64"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
          <path d="M13.73 21a2 2 0 0 1-3.46 0" />
        </svg>
        <p>No tienes notificaciones</p>
      </div>
      } @else { @for (notif of notificaciones; track notif.id_notificacion) {
      <div
        class="notification-item"
        [class.unread]="!notif.leida"
        [class.expanded]="isExpanded(notif.id_notificacion)"
        (click)="toggleExpand(notif.id_notificacion)"
      >
        <div class="notif-icon">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
          </svg>
        </div>
        <div class="notif-content">
          <h4>{{ notif.titulo }}</h4>
          <p [class.expanded-text]="isExpanded(notif.id_notificacion)">{{ notif.mensaje }}</p>
          <span class="notif-time">{{ getTimeAgo(notif.fecha_creacion) }}</span>
        </div>
        @if (!notif.leida) {
        <div class="unread-dot"></div>
        }
      </div>
      } }
    </div>
  </div>

  <!-- Overlay -->
  @if (showNotifications) {
  <div class="overlay" (click)="toggleNotifications()"></div>
  }

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Stats Section -->
    <section class="stats-section">
      <div class="stat-box stat-total">
        <div class="stat-icon">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ todosProyectos.length }}</h3>
          <p>Total Proyectos</p>
        </div>
        <div class="stat-wave"></div>
      </div>

      <div class="stat-box stat-asesor">
        <div class="stat-icon">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ getProyectosAsesor() }}</h3>
          <p>Como Asesor</p>
        </div>
        <div class="stat-wave"></div>
      </div>

      <div class="stat-box stat-jurado">
        <div class="stat-icon">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ getProyectosJurado() }}</h3>
          <p>Como Jurado</p>
        </div>
        <div class="stat-wave"></div>
      </div>
    </section>

    <!-- Projects Grid -->
    <section class="projects-section">
      <div class="section-header">
        <h2>Proyectos Asignados</h2>
        <span class="project-badge">{{ todosProyectos.length }} proyectos</span>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="loading-state">
        <div class="loader"></div>
        <p>Cargando proyectos...</p>
      </div>

      <!-- Error -->
      <div *ngIf="error && !loading" class="error-state">
        <svg
          width="64"
          height="64"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
        <h3>{{ error }}</h3>
        <button class="btn-retry" (click)="cargarTodosProyectos()">Reintentar</button>
      </div>

      <!-- Empty -->
      <div *ngIf="!loading && todosProyectos.length === 0 && !error" class="empty-state">
        <svg
          width="100"
          height="100"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
        </svg>
        <h3>¡Todo al día!</h3>
        <p>No tienes proyectos pendientes de revisión</p>
      </div>

      <!-- Projects List -->
      <div *ngIf="!loading && todosProyectos.length > 0" class="projects-grid">
        <div
          *ngFor="let proyecto of todosProyectos"
          class="project-item"
          [class.proyecto-asesor]="proyecto.tipo === 'ASESOR'"
          [class.proyecto-jurado]="proyecto.tipo === 'JURADO'"
        >
          <!-- Tipo Badge -->
          <div
            class="tipo-badge"
            [class.badge-asesor]="proyecto.tipo === 'ASESOR'"
            [class.badge-jurado]="proyecto.tipo === 'JURADO'"
            [class.badge-borrador]="proyecto.tipo === 'BORRADOR'"
          >
            <svg
              *ngIf="proyecto.tipo === 'ASESOR'"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
            </svg>
            <svg
              *ngIf="proyecto.tipo === 'JURADO'"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
            </svg>
            <svg
              *ngIf="proyecto.tipo === 'BORRADOR'"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <polyline points="14 2 14 8 20 8" />
              <line x1="16" y1="13" x2="8" y2="13" />
              <line x1="16" y1="17" x2="8" y2="17" />
              <polyline points="10 9 9 9 8 9" />
            </svg>
            <span>{{ getTipoBadge(proyecto.tipo) }}</span>
            <span *ngIf="proyecto.rol_jurado" class="rol-text"
              >- {{ getRolJuradoBadge(proyecto.rol_jurado) }}</span
            >
          </div>

          <!-- Project Content -->
          <div class="project-content">
            <div class="project-header">
              <h3 class="project-title">{{ proyecto.titulo }}</h3>
              <span class="project-id">#{{ proyecto.id_proyecto }}</span>
            </div>

            <div class="project-student">
              <div class="student-avatar-small">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
              </div>
              <div class="student-name">
                <span>{{ proyecto.nombre_estudiante }}</span>
                <small *ngIf="proyecto.codigo_estudiante">{{ proyecto.codigo_estudiante }}</small>
                <small *ngIf="proyecto.iteracion">Iteración {{ proyecto.iteracion }}</small>
              </div>
            </div>

            <p class="project-description">
              @if (proyecto.resumen) {
              {{ proyecto.resumen.substring(0, 100)
              }}{{ proyecto.resumen.length > 100 ? '...' : '' }}
              } @else { Sin resumen disponible }
            </p>
          </div>

          <!-- Project Actions -->
          <div class="project-actions">
            <button class="btn-secondary-modern" (click)="verPDF(proyecto.ruta_pdf, proyecto.tipo)">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
              </svg>
              Ver PDF
            </button>
            <button
              class="btn-primary-modern"
              [routerLink]="[
                proyecto.tipo === 'BORRADOR'
                  ? '/docente/borrador/revisar'
                  : proyecto.tipo === 'ASESOR'
                  ? '/docente/revisar'
                  : '/docente/evaluar',
                proyecto.tipo === 'BORRADOR' ? proyecto.id_borrador : proyecto.id_proyecto
              ]"
              [queryParams]="
                proyecto.tipo === 'BORRADOR'
                  ? { mode: proyecto.esJurado ? 'jurado' : 'asesor' }
                  : {}
              "
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="9 11 12 14 22 4" />
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
              </svg>
              {{
                proyecto.tipo === 'ASESOR' || proyecto.tipo === 'BORRADOR' ? 'Revisar' : 'Evaluar'
              }}
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
